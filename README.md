# Shadowrocket Rules

ä¸€ä¸ªåŸºç¡€ç‰ˆçš„Shadowrocketè§„åˆ™ã€‚

ä¸»æ‰“æ‡’äººé…ç½®ï¼Œç®€å•é«˜æ•ˆï¼Œæ‹’ç»å†—ä½™ï¼Œæ»¡è¶³æ—¥å¸¸ï¼Œå¤–è´¸ç”¨æˆ·ï¼ŒéæŠ€æœ¯èƒŒæ™¯äººå£«ã€‚


## ğŸ›¡ï¸ ä¼ä¸šå®‰å…¨ä¸ DLP å®šåˆ¶æœåŠ¡

æœ¬é¡¹ç›®éš¶å±äºç½‘ç»œå®‰å…¨ä¸æ•°æ®é˜²æŠ¤æ–¹å‘çš„åº”ç”¨ç ”ç©¶èŒƒç•´ã€‚  
æˆ‘ä¸ºä¼ä¸šåŠå¼€å‘è€…æä¾›ä»¥ä¸‹ **å®šåˆ¶åŒ–å®‰å…¨è§£å†³æ–¹æ¡ˆ**ï¼š

- ğŸŒ **DNS / åŸŸåæ™ºèƒ½åˆ†æ**ï¼šåŸºäºå¤§æ•°æ®çš„å¨èƒè¯†åˆ«ä¸è¡Œä¸ºå»ºæ¨¡  
- ğŸ§  **æ•°æ®é˜²æ³„æ¼ï¼ˆDLPï¼‰ç­–ç•¥å¼•æ“**ï¼šæ”¯æŒæ•æ„Ÿä¿¡æ¯æ£€æµ‹ä¸è§„åˆ™å®šåˆ¶  
- ğŸ“Š **å®‰å…¨å¯è§†åŒ–ä¸åˆè§„æŠ¥è¡¨**ï¼šå¸®åŠ©ä¼ä¸šæ»¡è¶³åˆè§„ä¸å†…éƒ¨å®¡è®¡éœ€æ±‚  
- ğŸ”— **API ä¸ç§æœ‰åŒ–éƒ¨ç½²æ”¯æŒ**ï¼šä¾¿äºé›†æˆè‡³ç°æœ‰å®‰å…¨ä½“ç³»

å¦‚éœ€äº†è§£ä¼ä¸šå®‰å…¨æˆ– DLP å®šåˆ¶å¼€å‘åˆä½œï¼Œè¯·é‚®ä»¶è”ç³»ã€‚

> åˆè§„ã€å®‰å…¨ã€éšç§ä¿æŠ¤ä¸ºæ ¸å¿ƒï¼Œæ‹’ç»ä¸€åˆ‡éæ³•ç”¨é€”ã€‚


#### ğŸ§¼ è‡ªåŠ¨æäº¤æ¸…ç†æœºåˆ¶è¯´æ˜ï¼ˆå¿…è¯» **[ğŸš¨ å¼€å‘è€…é¡»çŸ¥](#-å¼€å‘è€…é¡»çŸ¥)**ï¼‰

æœ¬é¡¹ç›®å¯ç”¨äº†è‡ªåŠ¨åŒ–æäº¤æ¸…ç†æœºåˆ¶ï¼š

- æ¯ 14 å¤©è‡ªåŠ¨è¿è¡Œä¸€æ¬¡ Git æ¸…ç†è„šæœ¬
- ä¼š **é‡å†™ä¸»åˆ†æ”¯å†å²ï¼ˆ`main`ï¼‰**
- è‡ªåŠ¨åˆ é™¤ **3 ä¸ªæœˆå‰çš„ `ci: auto-build` è‡ªåŠ¨æäº¤**

---

## é…ç½®æ–‡ä»¶ä»‹ç»

## default-DIRECT

(æœªå‘½ä¸­ï¼Œåˆ™ç›´è¿) ä¸»è¦åŠ å…¥å›½å¤–çš„åŸŸåã€‚è§„åˆ™åœ°å€ï¼š

|        | ç¼“å­˜(ä¼˜å…ˆæ¨è)                                                            | éç¼“å­˜                                                                  |
|--------|-------------------------------------------------------------------------|------------------------------------------------------------------------|
| ä¸å»å¹¿å‘Š | <img src=".github/qrcode/cdn_default-DIRECT.png?raw=true" width="150">  | <img src=".github/qrcode/gh_default-DIRECT.png?raw=true" width="150"> |
| å»å¹¿å‘Š   | <img src=".github/qrcode/cdn_advance-DIRECT.png?raw=true" width="150">  | <img src=".github/qrcode/gh_advance-DIRECT.png?raw=true" width="150"> |

- ç¼“å­˜ç‰ˆ
```
https://cdn.jsdelivr.net/gh/harmonsir/Shadowrocket-rules@main/default-DIRECT.conf
```

- éç¼“å­˜ç‰ˆ
```
https://github.com/harmonsir/Shadowrocket-rules/raw/main/default-DIRECT.conf
```


## default-PROXY

(æœªå‘½ä¸­ï¼Œåˆ™ä»£ç†) ä¸»è¦åŠ å…¥ä¸­å›½çš„åŸŸåã€‚è§„åˆ™åœ°å€ï¼š

|        | ç¼“å­˜(ä¼˜å…ˆæ¨è)                                                          | éç¼“å­˜                                                                |
|--------|-----------------------------------------------------------------------|----------------------------------------------------------------------|
| ä¸å»å¹¿å‘Š | <img src=".github/qrcode/cdn_default-PROXY.png?raw=true" width="150"> | <img src=".github/qrcode/gh_default-PROXY.png?raw=true" width="150"> |
| å»å¹¿å‘Š   | <img src=".github/qrcode/cdn_advance-PROXY.png?raw=true" width="150"> | <img src=".github/qrcode/gh_advance-PROXY.png?raw=true" width="150"> |

- ç¼“å­˜ç‰ˆ
```
https://cdn.jsdelivr.net/gh/harmonsir/Shadowrocket-rules@main/default-PROXY.conf
```

- éç¼“å­˜ç‰ˆ
```
https://github.com/harmonsir/Shadowrocket-rules/raw/main/default-PROXY.conf
```


### GeoLite2 - Country

```
https://cdn.jsdelivr.net/gh/Loyalsoldier/geoip@release/Country.mmdb
```

### GeoLite2 - ASN

```
https://cdn.jsdelivr.net/gh/P3TERX/GeoLite.mmdb@download/GeoLite2-ASN.mmdb
```


## ä¸“ä¸šäººå£«

è‡ªç”±æ­é…

```
DOMAIN-SET,ruleset-ocsp.conf,DIRECT
RULE-SET,ruleset-blacklist-ips.conf,REJECT-DROP
RULE-SET,ruleset-umeng.conf,REJECT-DROP
DOMAIN-SET,ruleset-adguard-dns.conf,REJECT
DOMAIN-SET,ruleset-easylist-china.conf,REJECT
RULE-SET,ruleset-v2fly-ads.conf,REJECT
RULE-SET,ruleset-v2fly-proxy.conf,PROXY
RULE-SET,ruleset-v2fly-cn.conf,DIRECT
RULE-SET,ruleset-asn-cn.conf,DIRECT
```


## æ³¨æ„äº‹é¡¹

windowsä¸‹ï¼Œçš„è·¯å¾„è½¬ä¹‰é—®é¢˜

```
go run ./ -exportlists "category-ads-all,cn,geolocation-\!cn"
```


## å‚è€ƒèµ„æ–™

- adguard
- easylist-china
- v2fly/domain-list-community
- https://bgp.he.net/country/CN
- 

---

### ğŸš¨ å¼€å‘è€…é¡»çŸ¥

è¯·åŠ¡å¿…æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼Œä»¥å…äº§ç”Ÿå†²çªæˆ–æ•°æ®ä¸¢å¤±ï¼š

#### âœ… å¦‚æœä½ æ˜¯åä½œè€…ï¼š

- **ä¸è¦é•¿æ—¶é—´åœ¨æœ¬åœ°ä¿ç•™æœªåŒæ­¥çš„ `main` åˆ†æ”¯**
- æ¯æ¬¡å¼€å‘å‰ï¼Œ**å…ˆåŒæ­¥è¿œç¨‹ä¸»åˆ†æ”¯**ï¼š

  ```bash
  git fetch origin
  git checkout main
  git reset --hard origin/main
  ```

* å¦‚æœä½ åŸºäºæ—§çš„ `main` åˆ†æ”¯å¼€å‘ï¼Œè¯·ä½¿ç”¨ **`rebase` è€Œé `merge`** æ¥æ›´æ–°ï¼š

  ```bash
  git fetch origin
  git rebase origin/main
  ```


### âš ï¸ å¦‚æœä½ é‡åˆ°è¿™äº›é—®é¢˜ï¼š

* Push æŠ¥é”™ï¼š`non-fast-forward`
* Pull æ˜¾ç¤ºå¤§é‡å†²çª
* æœ¬åœ°æäº¤â€œæ¶ˆå¤±â€

è¯·ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ¢å¤ä½ çš„å·¥ä½œï¼š

```bash
# ä¿å­˜å½“å‰å·¥ä½œä¸ºå¤‡ä»½åˆ†æ”¯
git checkout -b backup-before-rebase

# å¼ºåˆ¶é‡ç½® main åˆ†æ”¯ä¸ºè¿œç¨‹æœ€æ–°
git fetch origin
git checkout main
git reset --hard origin/main

# å¦‚æœéœ€è¦ï¼ŒæŠŠæ—§æäº¤ cherry-pick å›æ¥
git checkout backup-before-rebase
git log  # æ‰¾åˆ°ä½ éœ€è¦çš„æäº¤
git checkout main
git cherry-pick <commit-hash>
```


### âœ… æ¨èåä½œæ–¹å¼

1. æ°¸è¿œä¸è¦ç›´æ¥åœ¨ `main` ä¸Šå¼€å‘ï¼Œè¯·ä½¿ç”¨åŠŸèƒ½åˆ†æ”¯ï¼š

   ```bash
   git checkout -b feature/my-task
   ```

2. ä½¿ç”¨ Pull Request åˆå¹¶åˆ° `main`

3. é¿å…åœ¨ `main` ä¸Šæ‰‹åŠ¨æäº¤æˆ–å¼ºæ¨


### ğŸ¤” ä¸ºä»€ä¹ˆè¦æ¸…ç†å†å²ï¼Ÿ

* è‡ªåŠ¨æäº¤é¢‘ç¹ï¼Œé•¿æœŸå †ç§¯ä¼šæ±¡æŸ“ Git å†å²
* ä¿ç•™é‡è¦æ‰‹åŠ¨æäº¤çš„å¯è¯»æ€§
* å‡å°‘ä»“åº“ä½“ç§¯ï¼ŒåŠ å¿« clone å’Œ CI æ‰§è¡Œé€Ÿåº¦


> ç»éªŒæé†’ï¼šç”¨ git filter-repo çš„ commit-callback æ—¶ **ä¸è¦** ç”¨ commit.skip() æ¥åˆ é™¤å†å²æäº¤â€”â€”å®ƒå¯èƒ½ä¼šè¿å¸¦è·³è¿‡åç»­æäº¤ã€‚æ›´å®‰å…¨çš„åšæ³•æ˜¯æŠŠç›®æ ‡æäº¤çš„æ”¹åŠ¨æ¸…ç©ºï¼ˆcommit.file_changes = []ï¼‰ï¼Œè®©ç©ºæäº¤è¢«å·¥å…·è‡ªåŠ¨å‰”é™¤ã€‚æˆ‘èŠ±äº† ~2 å°æ—¶å®šä½å¹¶ä¿®å¤äº†è¿™ä¸ªå‘ã€‚

---

ğŸ“Œ å¦‚æœä½ å¯¹è¿™ä¸ªæœºåˆ¶æœ‰ç–‘é—®ï¼Œæ¬¢è¿é€šè¿‡ Issue åé¦ˆã€‚
